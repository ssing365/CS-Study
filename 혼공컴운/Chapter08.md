### 08-1 장치 컨트롤러와 장치 드라이버

### 장치 컨트롤러

- 장치 컨트롤러를 사용하는 이유
    - 입출력장치는 종류가 너무 많다.
        
        → 다양한 입출력장치와 정보를 주고받는 방식을 규격화하기 어렵다.
        
    - 입출력장치는 CPU와 메모리에 비해 데이터 전송률이 낮다.
        - 전송률 : 데이터를 얼마나 빨리 교환할 수 있는지 나타내는 지표
- 장치 컨트롤러의 역할
    - CPU와 입출력장치 간의 통신중개
        - 모든 입출력장치는 각자의 장치 컨트롤러를 통해 컴퓨터 내부와 정보를 주고받는다.
        - 입출력장치의 다양한 종류로 인해 규격화가 어려웠던 문제를 해소
    - 오류 검출
    - 데이터 버퍼링
        
        <aside>
        
        ☝️  버퍼링이란?
        
        - 전송률이 높은 장치와 낮은 장치 사이에 주고받는 데이터를 **버퍼라는 임시 저장 공간에 모아놨다가 전송하여 전송률을 비슷하게 맞추는 방법**
        </aside>
        
- 구조
    - 데이터 레지스터
        - CPU와 입출력장치 사이에 주고받을 데이터가 담기는 레지스터
        - 즉, 버퍼 역할
        - 데이터가 많은 입출력장치에서는 RAM을 사용하기도 함
    - 상태 레지스터
        - 입출력 작업 상태, 오류 여부 등 상태 정보 저장
    - 제어 레지스터
        - 입출력장치가 수행할 내용에 대한 제어 정보, 명령 저장

### 장치 드라이버

: 장치 컨트롤러가 컴퓨터 내부와 정보를 주고받을 수 있게 하는 프로그램

- 장치 컨트롤러가 입출력장치를 연결하기 위한 하드웨어적 통로라면,
- 장치 드라이버는 입출력장치를 연결하기 위한 소프트웨어적 통로
- 운영체제가 장치 드라이버를 인식하고 실행한다.
    - 운영체제가 드라이버를 인식 및 실행할 수 있다면 그 장치는 어떤 제품이든 컴퓨터와 정보를 주고받을 수 있다.
    - 운영체제가 기본 제공하는 드라이버가 아니라면 장치 제작자가 만들어야하고, 사용하려면 그걸 설치해야한다.

### 08-2 다양한 입출력 방법

> CPU와 장치컨트롤러가 정보를 주고받는 방법 세 가지
> 

### 1. 프로그램 입출력

: 프로그램 속 명령어로 입출력장치를 제어하는 법

- CPU가 장치 컨트롤러의 레지스터 값을 읽고 씀으로써 이루어짐

<aside>

CPU가 어떻게 여러 장치 컨트롤러 속 레지스터들을 알고 있을까?

- 메모리 맵 입출력
    - 메모리에 접근하기 위한 주소 공간과 입출력장치를 위한 주소 공간을 하나의 주소 공간으로 간주하는 입출력 방식
- 고립형 입출력
    - 메모리에 접근하기 위한 주소 공간과 입출력장치를 위한 주소 공간을 분리하는 방법
    - 입출력 읽기/쓰기 버스를 활성화 시키는 입출력 전용 명령어 사용
</aside>

### 2. 인터럽트 기반 입출력

: 인터럽트를 기반으로 하는 입출력

- 하드웨어 인터럽트는 장치 컨트롤러가 발생 시킴

<aside>

여러 입출력 장치에서 동시에 발생하는 인터럽트를 CPU는 어떻게 처리할까?

- 일반적으로 순차적으로 처리
- 정전같은 우선순위가 아주 높은 NMI(Non-Maskable Interrupt)가 발생하면 CPU는 그것부터 처리해야한다.
    
    ![스크린샷 2025-03-18 오후 7.03.45.jpg](attachment:ea0e9f2f-d40e-4433-9ba5-15f5dd2ef41f:스크린샷_2025-03-18_오후_7.03.45.jpg)
    
    - 다른 인터럽트 서비스루틴을 실행중이어도 해야함
    - PIC라는 하드웨어가 우선순위를 계산해 CPU에게 알림
</aside>

### 3. DMA 입출력

: 앞선 두 방법의 공통점은 CPU가 주도한다는 점인데, DMA 입출력방법은 DMA 컨트롤러라는 하드웨어가 주도한다.

- DMA 컨트롤러가 직접 메모리에 접근한다.
    - DMA: Direct Memory Access
- CPU의 부담을 줄일 수 있다.
- 사이클 스틸링
    - 시스템 버스는 동시 사용이 불가능하다.
    - DMA는 CPU가 시스템 버스를 사용하지 않는 틈을 타 작업을 처리해야한다 : 사이클 스틸링

<aside>

입출력 버스(PCI)

- DMA가 시스템버스를 두 번 사용하는 부작용을 방지하는 버스
    
    ![스크린샷 2025-03-18 오후 7.08.12.jpg](attachment:71a31e5f-e226-487c-8840-462f2d138aaa:스크린샷_2025-03-18_오후_7.08.12.jpg)
    
    ⬇️ 입출력 버스 등장!
    
    ![스크린샷 2025-03-18 오후 7.08.33.jpg](attachment:b96e2a3e-7384-4094-84d1-88bda57933d2:스크린샷_2025-03-18_오후_7.08.33.jpg)
    
</aside>